<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quantaa Reunion 2026 - Registration</title>

  <!-- Fonts & Icons -->

  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- Bootstrap CSS -->

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->

  <link rel="stylesheet" href="css/style.css">

  <!-- Lucide Icons -->

  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/lucide.min.js"></script>

  <!-- Supabase JS -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body>
<div class="container mt-5 mb-5">

  <!-- HEADER -->

  <div class="header mb-4 d-flex align-items-center gap-3">
    <span class="material-symbols-rounded" style="font-size:50px;color:rgb(3,129,255);">diversity_2</span>
    <div>
      <h1 class="title">QUANTAA REUNION - 2026</h1>
      <p class="subtitle">Together Again . . . .</p>
    </div>
  </div>

  <h2>Registration Form</h2>
  <div class="divider mb-3"></div>

  <!-- FORM -->

  <form id="registrationForm">

```
<!-- PERSONAL INFO -->
<h4>Personal Info</h4>
<div class="row mb-3">
  <div class="col-md-6 mb-3">
    <input type="text" class="form-control" id="quantaaID" placeholder="Quantaa ID" required>
  </div>
  <div class="col-md-6 mb-3">
    <input type="text" class="form-control" id="quantaaName" placeholder="Full Name" required>
  </div>
</div>
<div class="row mb-3">
  <div class="col-md-6 mb-3">
    <input type="number" class="form-control" id="quantaaPhone" placeholder="Phone Number" required>
  </div>
  <div class="col-md-6 mb-3">
    <input type="text" class="form-control" id="batchNo" placeholder="Batch No">
  </div>
</div>
<div class="mb-3">
  <input type="text" class="form-control" id="fullAddress" placeholder="Full Address">
</div>

<!-- ATTENDANCE & GUEST -->
<h4>Attendance & Guest Info</h4>
<div class="row mb-3">
  <div class="col-md-6 mb-3">
    <select class="form-select" id="tshirtSize" required>
      <option value="">Select T-shirt Size</option>
      <option value="S">S</option>
      <option value="M">M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
      <option value="XXL">XXL</option>
    </select>
  </div>
  <div class="col-md-6 mb-3 d-flex align-items-center">
    <input type="checkbox" class="form-check-input me-2" id="bringGuest">
    <label for="bringGuest" class="form-check-label fw-semibold">Bring Guest?</label>
  </div>
</div>
<div class="mb-3" id="guestCountContainer">
  <input type="number" class="form-control" id="numGuests" min="1" value="1" placeholder="Number of Guests">
</div>
<div class="mb-3" id="guestInfo">
  <input type="text" class="form-control" id="guestName" placeholder="Guest Name(s)">
</div>

<!-- PAYMENT INFO -->
<h4>Payment Info</h4>
<div class="row mb-3">
  <div class="col-md-6 mb-3">
    <input type="number" class="form-control" id="feeAmount" placeholder="Registration Fee Amount" required>
  </div>
  <div class="col-md-6 mb-3">
    <select class="form-select" id="paymentMethod" required>
      <option value="">Select Payment Method</option>
      <option value="bKash">bKash</option>
      <option value="Nagad">Nagad</option>
      <option value="Rocket">Rocket</option>
    </select>
  </div>
</div>
<div id="paymentNumberBox" class="mb-3">
  <h6 id="paymentMethodLabel">Payment Number</h6>
  <span id="paymentNumber">01XXXXXXXXX</span>
  <small>Send your payment and enter the Transaction ID below.</small>
  <button type="button" id="copyPaymentBtn" class="btn btn-sm btn-outline-primary mt-1">
    <i class="bi bi-clipboard"></i> Copy
  </button>
</div>
<div class="mb-3">
  <input type="text" class="form-control" id="transactionID" placeholder="Transaction ID" required>
</div>

<!-- OPTIONAL -->
<h4>Optional Info</h4>
<div class="mb-3">
  <textarea class="form-control" id="suggestion" rows="3" placeholder="Any suggestions for the Programme?"></textarea>
</div>

<!-- SUBMIT -->
<div class="text-center">
  <button type="submit" class="btn btn-primary btn-lg submit-btn">Register</button>
</div>
```

  </form>

  <!-- Footer -->

  <footer class="footer text-center mt-4">
    Made with <span class="heart">❤️</span> by <strong>Md. Parvez</strong>
  </footer>
</div>

<!-- Toast Container -->

<div class="position-fixed top-0 end-0 p-3" style="z-index:1100">
  <div id="toast" class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toast-body"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>lucide.createIcons();</script>

<!-- Custom JS -->

<script>
  // ---------------------------
  // Supabase setup
  // ---------------------------
  const supabaseUrl = "https://mmsfhjfjrjqyldkyfvgn.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tc2ZoamZqcmpxeWxka3lmdmduIiwicm9uIjoiYW5vbiIsImlhdCI6MTc2MzY2ODc2NSwiZXhwIjoyMDc5MjQ0NzY1fQ.9QseOdGWaLLjCktb7wE6GAMQsdklOXK3A4seW6UqD3U";
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);
  const tableName = "registration";

  // ---------------------------
  // Toast helper
  // ---------------------------
  function showToast(message, type="primary"){
    const toastEl = document.getElementById("toast");
    const toastBody = document.getElementById("toast-body");
    toastBody.textContent = message;
    toastEl.className = `toast align-items-center text-white bg-${type} border-0`;
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  }

  // ---------------------------
  // Guest toggle
  // ---------------------------
  const bringGuestCheckbox = document.getElementById("bringGuest");
  const guestFields = document.getElementById("guestInfo");
  const guestCount = document.getElementById("guestCountContainer");
  function toggleGuestFields(){
    if(bringGuestCheckbox.checked){
      guestFields.style.display = "block";
      guestCount.style.display = "block";
    } else {
      guestFields.style.display = "none";
      guestCount.style.display = "none";
    }
  }
  bringGuestCheckbox.addEventListener("change", toggleGuestFields);
  toggleGuestFields();

  // ---------------------------
  // Copy payment number
  // ---------------------------
  document.getElementById("copyPaymentBtn").addEventListener("click", ()=>{
    const paymentNumber = document.getElementById("paymentNumber").textContent;
    navigator.clipboard.writeText(paymentNumber).then(()=>{
      showToast("Payment number copied!", "success");
    });
  });

  // ---------------------------
  // Get timestamp
  // ---------------------------
  function getCurrentTimestamp(){ return new Date().toISOString(); }

  // ---------------------------
  // Form submit
  // ---------------------------
  document.getElementById("registrationForm").addEventListener("submit", async function(e){
    e.preventDefault();
    const form = e.target;
    const btn = form.querySelector(".submit-btn");
    btn.disabled = true;
    btn.textContent = "Submitting...";

    const quantaaID = document.getElementById("quantaaID").value.trim();

    // Duplicate check
    try{
      const { data: existing, error: searchError } = await supabase
        .from(tableName)
        .select("quantaaID")
        .eq("quantaaID", quantaaID);
      if(searchError) throw searchError;
      if(existing && existing.length>0){
        showToast("Quantaa ID already exists!", "danger");
        btn.disabled=false; btn.textContent="Register"; return;
      }
    }catch(err){
      console.error(err);
      showToast("Duplicate check error: "+(err.message||err),"danger");
      btn.disabled=false; btn.textContent="Register"; return;
    }

    // Collect form data
    const dataToInsert={
      quantaaID,
      quantaaName: document.getElementById("quantaaName").value.trim(),
      quantaaPhone: document.getElementById("quantaaPhone").value.trim(),
      batchNo: document.getElementById("batchNo").value.trim(),
      fullAddress: document.getElementById("fullAddress").value.trim(),
      tshirtSize: document.getElementById("tshirtSize").value,
      bringGuest: bringGuestCheckbox.checked ? "Yes":"No",
      numGuests: document.getElementById("numGuests").value,
      guestName: document.getElementById("guestName").value.trim(),
      feeAmount: document.getElementById("feeAmount").value.trim(),
      paymentMethod: document.getElementById("paymentMethod").value,
      transactionID: document.getElementById("transactionID").value.trim(),
      suggestion: document.getElementById("suggestion").value.trim(),
      recordedBy:"Self",
      recordedOn:getCurrentTimestamp(),
      status:"Recorded"
    };

    // Insert into Supabase
    try{
      const { data: insertedData, error: insertError } = await supabase
        .from(tableName)
        .insert([dataToInsert]);
      if(insertError){
        let errMsg=insertError.message;
        if(insertError.details) errMsg+=" | Details: "+insertError.details;
        console.error("Insert error:", insertError);
        showToast("Insert failed: "+errMsg,"danger");
      }else{
        showToast("✔ Registration submitted successfully!","success");
        form.reset();
        toggleGuestFields();
      }
    }catch(err){
      console.error("Unexpected insert error:", err);
      showToast("Unexpected error: "+(err.message||err),"danger");
    }

    btn.disabled=false;
    btn.textContent="Register";
  });
</script>

</body>
</html>
